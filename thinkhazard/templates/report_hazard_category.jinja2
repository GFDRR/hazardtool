{% macro report_for_hazard(division, hazard_category, recommendations,
   climate_change_recommendation, sources, resources, hazards_sorted=None,
   parents=[],
   parent_division=None) %}
<div class="col-sm-7">
  {% if hazard_category %}
    <h2 class="page-header detail">
      {{ hazard_category.hazardtype.title }}
      <small>
        Hazard level: <span class="level">{{ hazard_category.hazardlevel.title }}</span>
      </small>
    </h2>
    {% if hazard_category.general_recommendation %}
    <p>
    {{ hazard_category.general_recommendation|replace("name of location", "(" + division.name + ")")|markdown }}
    </p>
    {% endif %}

    {% if climate_change_recommendation %}
    <p>
      {{ climate_change_recommendation.text }}
    </p>
    {% endif %}

    {% if recommendations %}
    <h3>Recommendations</h3>
    <ul class="recommendations">
    {% for recommendation in recommendations %}
      <li class="list-unstyled">
        <i class="icon-list-square"></i>
        {{ recommendation.text }}
        {% if recommendation.detail %}
        {% set modal_id = 'recommendation-detail-' ~ recommendation.id %}
        <a class="small" data-toggle="modal" data-target="#{{ modal_id }}" href>More information</a>
        <!-- Modal -->
        <div class="modal fade" id="{{ modal_id }}" tabindex="-1" role="dialog" aria-labelledby="{{ modal_id }}-label">
          <div class="modal-dialog" role="document">
            <div class="modal-content">
              <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
              </div>
              <div class="modal-body">
                {{ recommendation.detail |markdown }}
              </div>
              <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
              </div>
            </div>
          </div>
        </div>
        {% endif %}
      </li>
    {% endfor %}
    </ul>
    {% endif %}
  {% else %}
    <aside class="hazard-level">Hazard level</aside>
    {% for hazard in hazards_sorted %}
    <a href="{{ 'report'|route_url(division=division, hazardtype=hazard.hazardtype.mnemonic) }}" aria-controls="{{ hazard.hazardtype.title }}" class="level-{{ hazard.hazardlevel.mnemonic }} overview">
      <h2 class="page-header">
        {{ hazard.hazardtype.title }}
        <small>
          <span class="level">{{ hazard.hazardlevel.title }}</span>
        </small>
      </h2>
    </a>
    {% endfor %}
  {% endif %}
</div>
<div class="col-sm-5">
  <div class="map-block">
    <div id="map" class="map">
      {% if parents.__len__() >= 1 %}
      <a class="btn btn-xs btn-default drillup" href="{{ 'report' | route_url(division=parents[0], hazardtype=hazard_category.hazardtype.mnemonic if hazard_category else '')}}">
        <i class="btn-xs icon-zoom-out"></i>
        Zoom out to {{ parent_division.name }}
      </a>
      {% endif %}
      <div class="alert alert-dismissible zoomin-help control btn-xs">
        <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        Zoom in by clicking on<br> an administrative area.</div>
      <div class="map-tooltip"></div>
      <div class="attribution">
        © <a href='https://www.mapbox.com/about/maps/'>Mapbox</a>
        © <a href='http://www.openstreetmap.org/copyright'>OpenStreetMap</a>
      </div>
    </div>
    {% if hazard_category %}
    <div class="caption level">
      {{ hazard_category.hazardtype.title}} hazard level
    </div>
    <div class="caption location">
      {{ division.name }}
    </div>
    <div class="legend">
      <table class="table">
        <tr>
          <td class="level-HIG">
            <i class="square"></i>
            High
          </td>
          <td class="level-LOW">
            <i class="square"></i>
            Low
          </td>
        </tr>
        <tr>
          <td class="level-MED">
            <i class="square"></i>
            Medium
          </td>
          <td class="level-VLO">
            <i class="square"></i>
            Very low
          </td>
        </tr>
      </table>
    </div>

    <div class="data-source text-center">
      <h5>DATA SOURCE{% if sources|length > 1 %}S{% endif %}</h5>
      {% for source in sources %}
      <a href="{{ 'data_source'|route_url(hazardset=source.id) }}">{{ source.owner_organization}}</a>
      {% if not loop.last %},&nbsp;{% endif %}
      {% endfor %}
    </div>
    {% endif %}
  </div>
  {% if resources and resources|length > 0 %}
  <div class="further-resources">
    <h3>Further resources</h3>
    <p>For further information the following resources could be consulted:</p>
    <ul>
    {% for resource in resources %}
    <li><i class="icon-list-arrow"></i>
      <a target="_blank" href="{{ resource.url }}">
        {{ resource.text }}
      </a>
    </li>
    {% endfor %}
    </ul>
  </div>
  {% endif %}
</div>
{% endmacro %}
